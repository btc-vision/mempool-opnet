<div class="opnet-tx-details" *ngIf="opnet">
  <!-- Transaction Type Badge -->
  <div class="tx-type-row">
    <span class="tx-type-badge" [ngClass]="opnet.opnetType?.toLowerCase()">
      {{ opnet.opnetType }}
    </span>
    <span class="badge badge-bip360" *ngIf="opnet.mldsaLink || opnet.features?.hasMLDSALink">
      BIP360
    </span>
    <span class="badge badge-epoch" *ngIf="opnet.epochSubmission || opnet.features?.hasEpochSubmission">
      EPOCH
    </span>
  </div>

  <!-- BIP360 / MLDSA Section -->
  <div class="mldsa-section" *ngIf="opnet.mldsaLink">
    <h4>
      <span class="section-icon quantum-icon">Q</span>
      Quantum-Safe Key Linking
    </h4>
    <table class="table table-sm table-borderless">
      <tbody>
        <tr>
          <td class="label">Security Level</td>
          <td>
            <span class="badge" [ngClass]="'level-' + opnet.mldsaLink.level?.toLowerCase()">
              {{ opnet.mldsaLink.level }}
            </span>
            <span class="algorithm">({{ mldsaAlgorithm }})</span>
          </td>
        </tr>
        <tr>
          <td class="label">Hashed Public Key</td>
          <td class="monospace">
            {{ truncateKey(opnet.mldsaLink.hashedPublicKey, 16) }}
            <button class="btn-copy" (click)="copyToClipboard(opnet.mldsaLink.hashedPublicKey)" title="Copy">
              <fa-icon [icon]="['fas', 'copy']"></fa-icon>
            </button>
          </td>
        </tr>
        <tr *ngIf="opnet.mldsaLink.fullPublicKey">
          <td class="label">Full ML-DSA Key</td>
          <td>
            <button class="btn btn-sm btn-outline-info" (click)="toggleFullKey()">
              {{ showFullKey ? 'Hide' : 'Show' }} ({{ publicKeySize }} bytes)
            </button>
            <pre *ngIf="showFullKey" class="key-display">{{ opnet.mldsaLink.fullPublicKey }}</pre>
          </td>
        </tr>
        <tr *ngIf="opnet.mldsaLink.tweakedKey">
          <td class="label">Tweaked Key</td>
          <td class="monospace">
            {{ truncateKey(opnet.mldsaLink.tweakedKey, 16) }}
            <button class="btn-copy" (click)="copyToClipboard(opnet.mldsaLink.tweakedKey)" title="Copy">
              <fa-icon [icon]="['fas', 'copy']"></fa-icon>
            </button>
          </td>
        </tr>
        <tr>
          <td class="label">Verification</td>
          <td>
            <span class="badge" [ngClass]="opnet.mldsaLink.isVerified ? 'badge-success' : 'badge-warning'">
              {{ opnet.mldsaLink.isVerified ? 'Verified' : 'Pending' }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Epoch Submission Section -->
  <div class="epoch-section" *ngIf="opnet.epochSubmission">
    <h4>
      <span class="section-icon epoch-icon">E</span>
      Mining Contribution
    </h4>
    <table class="table table-sm table-borderless">
      <tbody>
        <tr>
          <td class="label">Epoch Number</td>
          <td>{{ opnet.epochSubmission.epochNumber }}</td>
        </tr>
        <tr *ngIf="opnet.epochSubmission.minerPublicKey">
          <td class="label">Miner Address</td>
          <td class="monospace">
            {{ truncateKey(opnet.epochSubmission.minerPublicKey, 10) }}
            <button class="btn-copy" (click)="copyToClipboard(opnet.epochSubmission.minerPublicKey)" title="Copy">
              <fa-icon [icon]="['fas', 'copy']"></fa-icon>
            </button>
          </td>
        </tr>
        <tr *ngIf="opnet.epochSubmission.solution">
          <td class="label">Solution Hash</td>
          <td class="monospace">
            {{ truncateKey(opnet.epochSubmission.solution, 16) }}
            <button class="btn-copy" (click)="copyToClipboard(opnet.epochSubmission.solution)" title="Copy">
              <fa-icon [icon]="['fas', 'copy']"></fa-icon>
            </button>
          </td>
        </tr>
        <tr *ngIf="opnet.epochSubmission.graffiti">
          <td class="label">Graffiti</td>
          <td class="graffiti">{{ opnet.epochSubmission.graffiti }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Contract Interaction Details -->
  <div class="interaction-section" *ngIf="opnet.interaction">
    <h4>
      <span class="section-icon contract-icon">C</span>
      Contract Interaction
    </h4>
    <table class="table table-sm table-borderless">
      <tbody>
        <tr>
          <td class="label">Contract</td>
          <td class="monospace">
            <a [routerLink]="['/address', opnet.interaction.contractAddress]" class="contract-link">
              {{ truncateKey(opnet.interaction.contractAddress, 10) }}
            </a>
            <button class="btn-copy" (click)="copyToClipboard(opnet.interaction.contractAddress)" title="Copy">
              <fa-icon [icon]="['fas', 'copy']"></fa-icon>
            </button>
          </td>
        </tr>
        <tr>
          <td class="label">Sender</td>
          <td class="monospace">
            <a [routerLink]="['/address', opnet.interaction.from]" class="address-link">
              {{ truncateKey(opnet.interaction.from, 10) }}
            </a>
            <button class="btn-copy" (click)="copyToClipboard(opnet.interaction.from)" title="Copy">
              <fa-icon [icon]="['fas', 'copy']"></fa-icon>
            </button>
          </td>
        </tr>
        <tr *ngIf="opnet.interaction.calldataLength">
          <td class="label">Calldata Size</td>
          <td>{{ opnet.interaction.calldataLength }} bytes</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Deployment Details -->
  <div class="deployment-section" *ngIf="opnet.deployment">
    <h4>
      <span class="section-icon deploy-icon">D</span>
      Contract Deployment
    </h4>
    <table class="table table-sm table-borderless">
      <tbody>
        <tr>
          <td class="label">Contract</td>
          <td class="monospace">
            <a [routerLink]="['/address', opnet.deployment.contractAddress]" class="contract-link">
              {{ truncateKey(opnet.deployment.contractAddress, 10) }}
            </a>
            <button class="btn-copy" (click)="copyToClipboard(opnet.deployment.contractAddress)" title="Copy">
              <fa-icon [icon]="['fas', 'copy']"></fa-icon>
            </button>
          </td>
        </tr>
        <tr *ngIf="opnet.deployment.bytecodeLength">
          <td class="label">Bytecode Size</td>
          <td>{{ opnet.deployment.bytecodeLength }} bytes</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Gas Info -->
  <div class="gas-section" *ngIf="opnet.gasInfo">
    <h4>
      <span class="section-icon gas-icon">G</span>
      Gas Usage
    </h4>
    <table class="table table-sm table-borderless">
      <tbody>
        <tr>
          <td class="label">Gas Used</td>
          <td>{{ opnet.gasInfo.gasUsed }}</td>
        </tr>
        <tr *ngIf="opnet.gasInfo.specialGasUsed && opnet.gasInfo.specialGasUsed !== '0'">
          <td class="label">Special Gas</td>
          <td>{{ opnet.gasInfo.specialGasUsed }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
