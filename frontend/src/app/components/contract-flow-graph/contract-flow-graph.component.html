<div class="contract-flow-graph" *ngIf="tx">
  <h3 class="section-title">Smart Contract Flow</h3>

  <svg [attr.width]="width" [attr.height]="height" [attr.viewBox]="'0 0 ' + width + ' ' + height">
    <!-- Gradient definitions -->
    <defs>
      <linearGradient [id]="getGradientId()" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" [attr.stop-color]="getGradientColors().start" />
        <stop offset="100%" [attr.stop-color]="getGradientColors().end" />
      </linearGradient>

      <!-- Glow filter for paths -->
      <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
        <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
        <feMerge>
          <feMergeNode in="coloredBlur"/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>

    <!-- Input labels -->
    <g class="input-labels">
      <text x="10" [attr.y]="height / 2 - 30" class="label-text">
        {{ tx.vin.length }} Input{{ tx.vin.length !== 1 ? 's' : '' }}
      </text>
    </g>

    <!-- Input flow lines -->
    <g class="inputs">
      <path *ngFor="let path of inputPaths"
            [attr.d]="path.d"
            class="flow-line input-line"
            [attr.stroke]="'url(#' + getGradientId() + ')'"
            [attr.stroke-width]="path.strokeWidth"
            fill="none"
            stroke-linecap="round"
            filter="url(#glow)" />
    </g>

    <!-- Contract node (center) -->
    <g class="contract-node"
       [attr.transform]="'translate(' + contractNode?.x + ',' + contractNode?.y + ')'"
       *ngIf="contractNode">
      <!-- Node background -->
      <rect [attr.width]="contractNode.width"
            [attr.height]="contractNode.height"
            class="node-bg"
            [class.deployment]="contractType === 'deployment'"
            [class.interaction]="contractType === 'interaction'"
            rx="8" ry="8" />

      <!-- Contract type label -->
      <text [attr.x]="contractNode.width / 2"
            [attr.y]="contractNode.height / 2 - 8"
            class="node-label"
            text-anchor="middle">
        {{ contractNode.label }}
      </text>

      <!-- Contract address -->
      <text [attr.x]="contractNode.width / 2"
            [attr.y]="contractNode.height / 2 + 12"
            class="node-address"
            text-anchor="middle"
            *ngIf="contractAddress">
        {{ truncateAddress(contractAddress) }}
      </text>
    </g>

    <!-- Output flow lines -->
    <g class="outputs">
      <path *ngFor="let path of outputPaths"
            [attr.d]="path.d"
            class="flow-line output-line"
            [attr.stroke]="'url(#' + getGradientId() + ')'"
            [attr.stroke-width]="path.strokeWidth"
            fill="none"
            stroke-linecap="round"
            filter="url(#glow)" />
    </g>

    <!-- Output labels -->
    <g class="output-labels">
      <text [attr.x]="width - 10" [attr.y]="height / 2 - 30" class="label-text" text-anchor="end">
        {{ tx.vout.length }} Output{{ tx.vout.length !== 1 ? 's' : '' }}
      </text>
    </g>
  </svg>
</div>
