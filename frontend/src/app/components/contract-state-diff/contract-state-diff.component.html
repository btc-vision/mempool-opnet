<div class="contract-state-diff" *ngIf="stateDiffs?.length">
  <div class="header-row">
    <h3 class="section-title">
      Contract State Access
      <span class="badge badge-secondary ml-2">{{ getTotalAccessCount() }} keys</span>
    </h3>
    <button type="button"
            class="btn btn-outline-info btn-sm"
            (click)="isCollapsed = !isCollapsed">
      {{ isCollapsed ? 'Show' : 'Hide' }}
    </button>
  </div>

  <div class="box" [ngbCollapse]="isCollapsed">
    <div class="contract-group" *ngFor="let diff of stateDiffs">
      <!-- Contract header -->
      <div class="contract-header">
        <fa-icon [icon]="['fas', 'code']" class="contract-icon"></fa-icon>
        <span class="contract-address">
          {{ truncateAddress(diff.contractAddress) }}
        </span>
        <button class="btn btn-sm copy-btn"
                (click)="copyToClipboard(diff.contractAddress)"
                title="Copy address">
          <fa-icon [icon]="['fas', 'copy']" size="xs"></fa-icon>
        </button>
        <span class="access-count badge badge-secondary ml-auto">
          {{ diff.storageAccesses.length }} keys
        </span>
      </div>

      <!-- Storage table -->
      <table class="table table-sm storage-table">
        <thead>
          <tr>
            <th>Key</th>
            <th>Type</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let access of diff.storageAccesses"
              [class.access-read]="access.accessType === 'read'"
              [class.access-write]="access.accessType === 'write'">
            <td class="key-cell">
              <code>{{ truncateKey(access.storageKey) }}</code>
              <button class="btn btn-sm copy-btn"
                      (click)="copyToClipboard(access.storageKey)"
                      title="Copy key">
                <fa-icon [icon]="['fas', 'copy']" size="xs"></fa-icon>
              </button>
            </td>
            <td>
              <span class="badge" [ngClass]="getAccessTypeBadgeClass(access.accessType)">
                {{ access.accessType }}
              </span>
            </td>
            <td class="value-cell">
              <code>{{ truncateKey(access.value, 24) }}</code>
              <button class="btn btn-sm copy-btn"
                      (click)="copyToClipboard(access.value)"
                      title="Copy value"
                      *ngIf="access.value">
                <fa-icon [icon]="['fas', 'copy']" size="xs"></fa-icon>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
